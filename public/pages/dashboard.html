<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç ‚Äî CV Builder</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body id="root">

  <!-- –ù–ê–í–ò–ì–ê–¶–ò–Ø -->
  <nav id="nav" class="navbar">
    <div class="nav-container">
      <a class="nav-brand" href="/">
        <div class="brand-logo">
          <span class="brand-text">CV Builder</span>
        </div>
      </a>
      
      <div class="nav-menu">
        <div class="nav-dropdown">
          <button class="nav-dropdown-btn" type="button">
            <span>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</span>
            <span class="dropdown-arrow">‚ñº</span>
          </button>
          <div class="nav-dropdown-menu">
            <div class="dropdown-item">
              <a href="/pages/cv-templates">–®–∞–±–ª–æ–Ω—ã</a>
            </div>
            <div class="dropdown-item">
              <a href="/pages/cv-examples">–ü—Ä–∏–º–µ—Ä—ã</a>
            </div>
            <div class="dropdown-item">
              <a href="/pages/articles">–°—Ç–∞—Ç—å–∏</a>
            </div>
            <div class="dropdown-item">
              <a href="/pages/assessment">AI –¢–µ—Å—Ç –Ω–∞ –ø—Ä–æ—Ñ–ø—Ä–∏–≥–æ–¥–Ω–æ—Å—Ç—å</a>
            </div>
          </div>
        </div>
        <a class="nav-link" href="/pages/pricing">–¶–µ–Ω—ã</a>
        <a class="nav-link" href="/pages/faq">–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã</a>
      </div>
      
      <div class="nav-actions" id="navActions">
        <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ JavaScript -->
      </div>
    </div>
  </nav>

  <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ -->
  <main class="main-content">
    <div class="container" style="padding: 100px 20px; min-height: 80vh; max-width: 1200px; margin: 0 auto;">
      
      <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
      <div id="loading" style="text-align: center; padding: 4rem;">
        <h2 style="color: #6b7280;">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
      </div>

      <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–∞—à–±–æ—Ä–¥–∞ -->
      <div id="dashboard" style="display: none;">
        
        <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
        <div class="hero-section" style="padding: 2rem 0; margin-bottom: 3rem;">
          <h1 id="welcomeMessage" class="hero-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≤–∞—à –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç!</h1>
          <p class="hero-description">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–≤–æ–∏–º–∏ —Ä–µ–∑—é–º–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∞–∫–∫–∞—É–Ω—Ç–∞</p>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin-bottom: 3rem;">
          
          <div style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; padding: 2rem; border-radius: 1rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
            <div style="display: flex; align-items: center; justify-content: space-between;">
              <div>
                <h3 style="font-size: 2.25rem; font-weight: 700; margin-bottom: 0.5rem;" id="resumeCount">0</h3>
                <p style="opacity: 0.9;">–†–µ–∑—é–º–µ —Å–æ–∑–¥–∞–Ω–æ</p>
              </div>
              <div style="font-size: 2rem;">üìÑ</div>
            </div>
          </div>

          <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 2rem; border-radius: 1rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
            <div style="display: flex; align-items: center; justify-content: space-between;">
              <div>
                <h3 style="font-size: 2.25rem; font-weight: 700; margin-bottom: 0.5rem;">PRO</h3>
                <p style="opacity: 0.9;">–í–∞—à —Ç–∞—Ä–∏—Ñ–Ω—ã–π –ø–ª–∞–Ω</p>
              </div>
              <div style="font-size: 2rem;">‚≠ê</div>
            </div>
          </div>

          <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 2rem; border-radius: 1rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
            <div style="display: flex; align-items: center; justify-content: space-between;">
              <div>
                <h3 style="font-size: 2.25rem; font-weight: 700; margin-bottom: 0.5rem;" id="memberSince">2025</h3>
                <p style="opacity: 0.9;">–ì–æ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</p>
              </div>
              <div style="font-size: 2rem;">üóìÔ∏è</div>
            </div>
          </div>

        </div>

        <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
        <div style="background: white; border-radius: 1rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); padding: 2rem; margin-bottom: 3rem;">
          <h2 style="color: #111827; margin-bottom: 1.5rem; font-size: 1.5rem;">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            
            <a href="/pages/cv-builder" class="btn btn-primary" style="display: flex; align-items: center; justify-content: center; padding: 1.5rem; text-decoration: none;">
              <span style="margin-right: 0.5rem;">‚ûï</span>
              –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Ä–µ–∑—é–º–µ
            </a>

            <a href="/pages/cv-templates" class="btn btn-outline" style="display: flex; align-items: center; justify-content: center; padding: 1.5rem; text-decoration: none;">
              <span style="margin-right: 0.5rem;">üé®</span>
              –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —à–∞–±–ª–æ–Ω—ã
            </a>

            <button onclick="showSettings()" class="btn btn-outline" style="display: flex; align-items: center; justify-content: center; padding: 1.5rem;">
              <span style="margin-right: 0.5rem;">‚öôÔ∏è</span>
              –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞
            </button>

          </div>
        </div>

        <!-- –ú–æ–∏ —Ä–µ–∑—é–º–µ -->
        <div style="background: white; border-radius: 1rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); padding: 2rem;">
          <h2 style="color: #111827; margin-bottom: 1.5rem; font-size: 1.5rem;">–ú–æ–∏ —Ä–µ–∑—é–º–µ</h2>
          
          <div id="resumesList">
            <div style="text-align: center; padding: 3rem; color: #6b7280;">
              <div style="font-size: 4rem; margin-bottom: 1rem;">üìÑ</div>
              <h3 style="margin-bottom: 1rem;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∑—é–º–µ</h3>
              <p style="margin-bottom: 2rem;">–°–æ–∑–¥–∞–π—Ç–µ –≤–∞—à–µ –ø–µ—Ä–≤–æ–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–µ–∑—é–º–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å</p>
              <a href="/pages/cv-builder" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å —Ä–µ–∑—é–º–µ</a>
            </div>
          </div>
        </div>

      </div>

      <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ -->
      <div id="error" style="display: none; text-align: center; padding: 4rem;">
        <h2 style="color: #dc2626;">–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω</h2>
        <p style="color: #6b7280; margin-bottom: 2rem;">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–∏—á–Ω–æ–º—É –∫–∞–±–∏–Ω–µ—Ç—É</p>
        <a href="/pages/login" class="btn btn-primary">–í–æ–π—Ç–∏</a>
      </div>
      
    </div>
  </main>

  <script>
    let currentUser = null;

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    async function loadDashboard() {
      try {
        const response = await fetch('/api/user');
        const result = await response.json();
        
        if (result.authenticated) {
          currentUser = result.user;
          showDashboard();
        } else {
          showError();
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
        showError();
      }
    }

    function showDashboard() {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('dashboard').style.display = 'block';
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
      document.getElementById('welcomeMessage').textContent = 
        `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${currentUser.firstName}!`;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
      const navActions = document.getElementById('navActions');
      navActions.innerHTML = `
        <div class="nav-dropdown">
          <button class="nav-dropdown-btn" type="button">
            <span>${currentUser.firstName}</span>
            <span class="dropdown-arrow">‚ñº</span>
          </button>
          <div class="nav-dropdown-menu">
            <div class="dropdown-item">
              <a href="/pages/dashboard">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
            </div>
            <div class="dropdown-item">
              <a href="#" onclick="logout()">–í—ã–π—Ç–∏</a>
            </div>
          </div>
        </div>
        <a class="btn btn-primary cta" href="/pages/cv-builder">–°–æ–∑–¥–∞—Ç—å —Ä–µ–∑—é–º–µ</a>
      `;

      // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ä–µ–∑—é–º–µ
      loadResumesList();
    }

    function showError() {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('error').style.display = 'block';
    }

    async function logout() {
      try {
        const response = await fetch('/api/logout', { method: 'POST' });
        const result = await response.json();
        
        if (result.success) {
          window.location.href = '/';
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:', error);
        window.location.href = '/';
      }
    }

    function showSettings() {
      alert('–†–∞–∑–¥–µ–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
    }

    async function loadResumesList() {
      try {
        const resp = await fetch('/api/cv/list');
        const data = await resp.json();
        if (!resp.ok || !data?.success) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∑—é–º–µ');
        const cvs = Array.isArray(data.cvs) ? data.cvs : [];
        document.getElementById('resumeCount').textContent = String(cvs.length);
        const listRoot = document.getElementById('resumesList');
        if (cvs.length === 0) {
          listRoot.innerHTML = `
            <div style="text-align: center; padding: 3rem; color: #6b7280;">
              <div style="font-size: 4rem; margin-bottom: 1rem;">üìÑ</div>
              <h3 style="margin-bottom: 1rem;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∑—é–º–µ</h3>
              <p style="margin-bottom: 2rem;">–°–æ–∑–¥–∞–π—Ç–µ –≤–∞—à–µ –ø–µ—Ä–≤–æ–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–µ–∑—é–º–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å</p>
              <a href="/pages/cv-builder" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å —Ä–µ–∑—é–º–µ</a>
            </div>`;
          return;
        }
        // –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞
        listRoot.innerHTML = cvs.map(cv => {
          const title = cv.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
          const sub = [cv.personalInfo?.jobPosition, cv.personalInfo?.fullName].filter(Boolean).join(' ¬∑ ');
          const date = cv.updatedAt ? new Date(cv.updatedAt).toLocaleString() : '';
          return `
            <div style="display:flex; align-items:center; justify-content:space-between; padding:1rem; border:1px solid #e5e7eb; border-radius:.75rem; margin-bottom:.75rem;">
              <div>
                <div style="font-weight:600; color:#111827;">${title}</div>
                <div style="font-size:.875rem; color:#6b7280;">${sub || ''}</div>
                <div style="font-size:.75rem; color:#9ca3af;">${date}</div>
              </div>
              <div style="display:flex; gap:.5rem;">
                <button onclick="editCV('${cv._id}')" class="btn btn-outline">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                <button onclick="previewCV('${cv._id}')" class="btn btn-outline">–ü—Ä–µ–≤—å—é</button>
                <button onclick="deleteCV('${cv._id}')" class="btn btn-primary" style="background:#ef4444; border-color:#ef4444;">–£–¥–∞–ª–∏—Ç—å</button>
              </div>
            </div>`;
        }).join('');
      } catch (e) {
        console.error(e);
      }
    }

    async function editCV(id) {
      // –û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –ø–æ id
      window.location.href = `/pages/cv-builder?id=${encodeURIComponent(id)}`;
    }

    async function previewCV(id) {
      try {
        const resp = await fetch(`/api/cv/${id}`);
        const data = await resp.json();
        if (resp.ok && data?.success && data.cv) {
          localStorage.setItem('cvBuilderData', JSON.stringify(data.cv));
          window.open('/pages/cv-preview', '_blank');
        }
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–µ–≤—å—é CV:', e);
      }
    }

    async function deleteCV(id) {
      if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Ä–µ–∑—é–º–µ?')) return;
      try {
        const resp = await fetch(`/api/cv/${id}`, { method: 'DELETE' });
        const data = await resp.json();
        if (resp.ok && data?.success) {
          loadResumesList();
        }
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è CV:', e);
      }
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞—à–±–æ—Ä–¥ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadDashboard();
  </script>

  <script src="/js/main.js"></script>
</body>
</html>